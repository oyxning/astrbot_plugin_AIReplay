# AIReplay â€” AstrBot ä¸»åŠ¨ç»­èŠä¸æé†’æ’ä»¶

> **ä½œè€…**ï¼šLumineStory  
> **ä»“åº“**ï¼š<https://github.com/oyxning/astrbot_plugin_AIReplay>  

AIReplay ä¸º AstrBot æä¾›ã€Œ**å®šæ—¶/é—´éš”ä¸»åŠ¨ç»­èŠ**ã€ã€Œ**äººæ ¼ä¸Šä¸‹æ–‡**ã€ã€Œ**æœ€è¿‘èŠå¤©è®°å½•æ‹¼æ¥**ã€ã€Œ**å…æ‰“æ‰°**ã€ä¸ã€Œ**å®šæ—¶æé†’**ã€èƒ½åŠ›ã€‚å®ƒå¯ä»¥åœ¨**æœ€åä¸€æ¡æ¶ˆæ¯åçš„æŒ‡å®šæ—¶é•¿**æˆ–**æ¯å¤©å›ºå®šæ—¶é—´**ï¼Œç”± Bot ä¸»åŠ¨è‡ªç„¶åˆ‡å…¥å¯¹è¯ï¼›ä¹Ÿå¯ä»¥è®¾ç½®**å…æ‰“æ‰°æ—¶æ®µ**ã€**è¿½åŠ æ—¶é—´å­—æ®µ**ï¼Œä»¥åŠä¸ºä¼šè¯åˆ›å»º**ä¸€æ¬¡æ€§/æ¯æ—¥æé†’**ã€‚

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- **ä¸¤ç±»ä¸»åŠ¨è§¦å‘**
  - **é—´éš”è§¦å‘**ï¼šæœ€åä¸€æ¡æ¶ˆæ¯å *N* åˆ†é’Ÿè‡ªåŠ¨ç»­èŠï¼ˆ`after_last_msg_minutes`ï¼‰ã€‚
  - **æ¯æ—¥è§¦å‘**ï¼šæ¯å¤©ä¸¤æ¡£å›ºå®šæ—¶é—´ï¼ˆ`daily.time1` / `daily.time2`ï¼‰ï¼Œå¦‚å†²çªè‡ªåŠ¨é”™å³° 1 åˆ†é’Ÿã€‚
- **è‡ªç„¶ç»­èŠ**
  - ç»§æ‰¿æˆ–è¦†ç›–**äººæ ¼**ï¼ˆsystem promptï¼‰ã€‚
  - æºå¸¦**æœ€è¿‘ N æ¡èŠå¤©è®°å½•**æ„æˆä¸Šä¸‹æ–‡ï¼ˆ`history_depth`ï¼‰ã€‚
  - å¯é…ç½®**è‡ªå®šä¹‰æç¤ºè¯**ï¼ˆæ”¯æŒå ä½ç¬¦ï¼š`{now}`ã€`{last_user}`ã€`{last_ai}`ã€`{umo}`ï¼‰ã€‚
- **å…æ‰“æ‰°**
  - `quiet_hours` æ”¯æŒ **è·¨å¤©**åŒºé—´ï¼ˆå¦‚ `22:00-07:30`ï¼‰ã€‚å…æ‰“æ‰°å†…ä¸è§¦å‘ä¸»åŠ¨å›å¤ã€‚
- **æ—¶é—´å­—æ®µ**
  - å¯é€‰åœ¨ä¸»åŠ¨æ¶ˆæ¯å‰è¿½åŠ  `[YYYY-MM-DD HH:MM]` ç­‰æ—¶é—´æ ‡ç­¾ï¼ˆ`append_time_field` + `time_format`ï¼‰ã€‚
- **å®šæ—¶æé†’**
  - ä¸€æ¬¡æ€§/æ¯æ—¥æé†’ï¼š`/aireplay remind add ...`ï¼Œåˆ°ç‚¹ç›´æ¥å‘ä¼šè¯å‘é€æç¤ºã€‚
- **è®¢é˜…æ¨¡å‹**
  - ä»…å‘**å·²è®¢é˜…ä¼šè¯**å‘é€ä¸»åŠ¨æ¶ˆæ¯ã€‚æ”¯æŒ `manual`ï¼ˆé»˜è®¤ï¼‰ä¸ `auto` ä¸¤ç§è®¢é˜…æ–¹å¼ã€‚

> è¯´æ˜ï¼šä¸åŒ IM å¹³å°å¯¹â€œä¸»åŠ¨æ¶ˆæ¯â€çš„æ”¯æŒæƒ…å†µä¸åŒï¼Œè¯·ä»¥ AstrBot å¯¹ç›®æ ‡å¹³å°çš„æ”¯æŒä¸ºå‡†ã€‚

---

## ğŸ“¦ å®‰è£…

1. ä» Release æˆ–æœ¬ä»“åº“è·å–æ’ä»¶åŒ…ï¼Œè§£å‹åˆ°ï¼š  
   `AstrBot/data/plugins/astrbot_plugin_aireplay/`
2. å¯åŠ¨ï¼ˆæˆ–é‡å¯ï¼‰AstrBotã€‚
3. è¿›å…¥ WebUI â†’ **æ’ä»¶** â†’ å¯ç”¨ **AIReplay**ã€‚
4. ï¼ˆå¯é€‰ï¼‰åœ¨æ’ä»¶é…ç½®é¡µå®Œæˆå‚æ•°è®¾ç½®ã€‚

ç›®å½•ç»“æ„ç¤ºä¾‹ï¼š

```
AstrBot/
â””â”€ data/
   â””â”€ plugins/
      â””â”€ astrbot_plugin_aireplay/
         â”œâ”€ main.py
         â”œâ”€ _conf_schema.json
         â”œâ”€ metadata.yaml
         â”œâ”€ README.md
         â””â”€ requirements.txt
```

## ğŸ§© é…ç½®é¡¹ï¼ˆ`_conf_schema.json`ï¼‰

| é”®å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|---|---|---:|---|
| `enable` | bool | `true` | å¯ç”¨/åœç”¨æ’ä»¶ã€‚ |
| `timezone` | string | `""` | IANA æ—¶åŒºï¼ˆç¤ºä¾‹ `Asia/Shanghai`ã€`America/Los_Angeles`ï¼‰ã€‚ä¸ºç©ºä½¿ç”¨ç³»ç»Ÿæ—¶åŒºã€‚ |
| `after_last_msg_minutes` | int | `0` | æœ€åä¸€æ¡æ¶ˆæ¯å N åˆ†é’Ÿä¸»åŠ¨ç»­èŠã€‚`0` ä»£è¡¨å…³é—­æ­¤è§¦å‘å™¨ã€‚ |
| `daily.time1` | string | `""` | æ¯æ—¥è§¦å‘æ—¶é—´ 1ï¼ˆ`HH:MM`ï¼Œ24hï¼‰ã€‚ |
| `daily.time2` | string | `""` | æ¯æ—¥è§¦å‘æ—¶é—´ 2ï¼ˆ`HH:MM`ï¼‰ã€‚è‹¥ä¸ `time1` ç›¸åŒä¼šè‡ªåŠ¨ **+1 åˆ†é’Ÿ** é”™å³°ã€‚ |
| `quiet_hours` | string | `""` | å…æ‰“æ‰°æ—¶æ®µï¼ˆ`HH:MM-HH:MM`ï¼‰ï¼Œæ”¯æŒè·¨å¤©ã€‚å…æ‰“æ‰°å†…ä¸ä¸»åŠ¨è§¦å‘ã€‚ |
| `history_depth` | int | `8` | æºå¸¦æœ€è¿‘èŠå¤©æ¡æ•°ï¼ˆä»å½“å‰ä¼šè¯å†å²æå–ï¼‰ã€‚ |
| `persona_override` | text | `""` | è¦†ç›–é»˜è®¤äººæ ¼çš„ System Promptï¼ˆç•™ç©ºä½¿ç”¨å½“å‰ä¼šè¯äººæ ¼ï¼‰ã€‚ |
| `custom_prompt` | text | `""` | è‡ªå®šä¹‰æç¤ºè¯æ¨¡æ¿ï¼ˆå ä½ç¬¦ï¼š`{now}`ã€`{last_user}`ã€`{last_ai}`ã€`{umo}`ï¼‰ã€‚ |
| `append_time_field` | bool | `false` | åœ¨ä¸»åŠ¨æ¶ˆæ¯å‰è¿½åŠ æ—¶é—´å­—æ®µã€‚ |
| `time_format` | string | `"%Y-%m-%d %H:%M"` | æ—¶é—´å­—æ®µæ ¼å¼ï¼ˆPython `strftime`ï¼‰ã€‚ |
| `subscribe_mode` | string(`manual`/`auto`) | `manual` | è®¢é˜…æ–¹å¼ï¼š`manual` éœ€è¦æ‰‹åŠ¨ `/aireplay watch`ï¼›`auto` æœ‰äº’åŠ¨å³è‡ªåŠ¨çº³å…¥ã€‚ |
| `_special.provider` | string | `""` | ï¼ˆå¯é€‰ï¼‰å›ºå®šä½¿ç”¨çš„ Provider IDï¼Œç•™ç©ºæŒ‰ä¼šè¯é»˜è®¤ã€‚ |
| `_special.persona` | string | `""` | ï¼ˆå¯é€‰ï¼‰å›ºå®šäººæ ¼ IDï¼Œç•™ç©ºæŒ‰ä¼šè¯é»˜è®¤ã€‚ |

### è‡ªå®šä¹‰æç¤ºè¯å ä½ç¬¦ç¤ºä¾‹

```text
ä½ æ˜¯æš–å¿ƒåŠ©ç†ï¼Œè¯·ä»¥å…³æ€€å£å»è‡ªç„¶ç»­èŠã€‚
æ—¶é—´ï¼š{now}
ç”¨æˆ·ä¸Šä¸€å¥ï¼š{last_user}
ä½ çš„ä¸Šä¸€å¥ï¼š{last_ai}
ä¼šè¯IDï¼š{umo}
è¯·ç»™ä¸€ä¸ªå°å»ºè®®å¹¶è¿½é—®ä¸€å¥ã€‚
```

---

## ğŸš€ å¿«é€Ÿä¸Šæ‰‹

1. åœ¨è¦â€œä¸»åŠ¨ç»­èŠâ€çš„ä¼šè¯é‡Œå‘é€ï¼š

```
/aireplay on
/aireplay watch
```

2. è®¾å®šè§¦å‘æ–¹å¼ï¼ˆäºŒé€‰ä¸€æˆ–åŒæ—¶ä½¿ç”¨ï¼‰ï¼š

- **é—´éš”è§¦å‘**ï¼ˆæœ€åæ¶ˆæ¯å 30 åˆ†é’Ÿï¼‰  
  ` /aireplay set after 30 `

- **æ¯æ—¥è§¦å‘**ï¼ˆæ¯å¤© 09:00 ä¸ 19:00ï¼‰  
  ```
  /aireplay set daily1 09:00
  /aireplay set daily2 19:00
  ```

3. ï¼ˆå¯é€‰ï¼‰è®¾ç½®å…æ‰“æ‰°ï¼š  
   ` /aireplay set quiet 22:00-07:30 `

4. ï¼ˆå¯é€‰ï¼‰è®¾ç½®è‡ªå®šä¹‰æç¤ºè¯ã€å†å²æ·±åº¦ï¼š  
   ```
   /aireplay set prompt ä½ æ˜¯æš–å¿ƒåŠ©ç†ï¼Œå‚è€ƒç”¨æˆ·ä¸Šä¸€å¥ä¸ä¸Šä¸‹æ–‡ï¼Œè‡ªç„¶ç»­èŠå¹¶æä¾›ä¸€ä¸ªè´´å¿ƒå»ºè®®ã€‚
   /aireplay set history 8
   ```

---

## ğŸ’¬ æŒ‡ä»¤å…¨é›†

- åŸºç¡€
  - `/aireplay on` / `/aireplay off` â€” å¯ç”¨/åœç”¨
  - `/aireplay watch` / `/aireplay unwatch` â€” è®¢é˜…/é€€è®¢å½“å‰ä¼šè¯ï¼ˆä»…è®¢é˜…ä¼šè¯ä¼šæ¥æ”¶ä¸»åŠ¨æ¶ˆæ¯ï¼‰
  - `/aireplay show` â€” æŸ¥çœ‹å½“å‰ä¼šè¯è®¢é˜…çŠ¶æ€ä¸æ ¸å¿ƒé…ç½®æ‘˜è¦
- è§¦å‘è®¾ç½®
  - `/aireplay set after <åˆ†é’Ÿ>` â€” è®¾ç½®â€œæœ€åæ¶ˆæ¯å N åˆ†é’Ÿè§¦å‘â€ï¼›è®¾ä¸º `0` å¯å…³é—­
  - `/aireplay set daily1 <HH:MM>` â€” è®¾ç½®æ¯æ—¥è§¦å‘æ—¶é—´ 1
  - `/aireplay set daily2 <HH:MM>` â€” è®¾ç½®æ¯æ—¥è§¦å‘æ—¶é—´ 2
  - `/aireplay set quiet <HH:MM-HH:MM>` â€” è®¾ç½®å…æ‰“æ‰°æ—¶æ®µï¼ˆå¯è·¨å¤©ï¼‰
  - `/aireplay set history <N>` â€” è®¾ç½®æºå¸¦æœ€è¿‘èŠå¤©æ¡æ•°
  - `/aireplay set prompt <æ–‡æœ¬>` â€” è®¾ç½®è‡ªå®šä¹‰æç¤ºè¯ï¼ˆæ”¯æŒå ä½ç¬¦ï¼‰
- æé†’
  - `/aireplay remind add <YYYY-MM-DD HH:MM> <å†…å®¹>` â€” æ–°å¢**ä¸€æ¬¡æ€§**æé†’
  - `/aireplay remind add <HH:MM> <å†…å®¹> daily` â€” æ–°å¢**æ¯æ—¥**æé†’
  - `/aireplay remind list` â€” æŸ¥çœ‹æé†’åˆ—è¡¨
  - `/aireplay remind del <ID>` â€” åˆ é™¤æé†’

---

## ğŸ§  å·¥ä½œåŸç†ï¼ˆç®€è¿°ï¼‰

- **è°ƒåº¦å¾ªç¯**ï¼šæ’ä»¶å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª ~30 ç§’çš„è°ƒåº¦å¾ªç¯ tickï¼š
  1. è‹¥ `enable=false`ï¼Œè·³è¿‡ã€‚
  2. è¯»å–æ—¶åŒºã€å…æ‰“æ‰°ã€å†å²æ·±åº¦ä¸æ¯æ—¥æ—¶é—´ç‚¹ã€‚
  3. å¯¹æ¯ä¸ª**å·²è®¢é˜…**ä¼šè¯ï¼š
     - è‹¥å½“å‰å¤„äºå…æ‰“æ‰°ï¼Œè·³è¿‡ã€‚
     - è‹¥è·ç¦»æœ€åæ¶ˆæ¯å·²è¶…è¿‡ `after_last_msg_minutes`ï¼Œè§¦å‘â€œé—´éš”ç»­èŠâ€ã€‚
     - è‹¥å½“å‰åˆ†é’Ÿå‘½ä¸­ `daily.time1/time2`ï¼Œè§¦å‘â€œæ¯æ—¥ç»­èŠâ€ã€‚
     - åˆ©ç”¨â€œä¸Šæ¬¡è§¦å‘æ ‡ç­¾â€å»é‡ï¼ˆåŒä¸€åˆ†é’Ÿä¸é‡å¤ï¼‰ã€‚
  4. æ‰«æ**æé†’**ï¼šåˆ°ç‚¹å‘é€ä¸€æ¬¡æ€§æé†’ï¼›æ¯æ—¥æé†’æŒ‰ HH:MM å‘½ä¸­å³å‘ã€‚
- **ä¸Šä¸‹æ–‡æ‹¼æ¥**ï¼šä» `ConversationManager` å–ä¼šè¯å†å²ï¼›è‹¥ä¸å¯ç”¨åˆ™é€€åŒ–ä½¿ç”¨æœ¬æ’ä»¶çš„è½»é‡å†å²ç¼“å­˜ã€‚
- **äººæ ¼ç­–ç•¥**ï¼šé»˜è®¤æ²¿ç”¨å½“å‰ä¼šè¯äººæ ¼ï¼Œå¯é€šè¿‡ `persona_override` æˆ– `_special.persona` è¦†ç›–ã€‚
- **Provider é€‰æ‹©**ï¼šé»˜è®¤ä½¿ç”¨ä¼šè¯å½“å‰ Providerï¼Œå¯é€šè¿‡ `_special.provider` å›ºå®šã€‚

---

## ğŸ§ª ä½¿ç”¨å»ºè®®

- **é¿å…éªšæ‰°**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ç»´æŒ `subscribe_mode=manual`ï¼Œåªå¯¹æ˜ç¡®è®¢é˜…çš„ä¼šè¯ä¸»åŠ¨ç»­èŠã€‚  
- **æ—¶é—´ä¸æ—¶åŒº**ï¼šè·¨æ—¶åŒºéƒ¨ç½²æ—¶å»ºè®®æ˜¾å¼è®¾ç½® `timezone`ï¼Œå¹¶åœ¨ UI ä¸­ç¡®è®¤æ¯æ—¥è§¦å‘æ—¶åˆ»ã€‚  
- **è‡ªå®šä¹‰æç¤ºè¯**ï¼šç»“åˆ `{last_user}` ä¸ `{last_ai}` èƒ½æ˜¾è‘—æé«˜â€œè‡ªç„¶åˆ‡å…¥â€æ„Ÿã€‚  
- **å†å²æ·±åº¦**ï¼š`history_depth` ä¸å®œè¿‡å¤§ï¼Œä»¥å…æ¨¡å‹æˆæœ¬ä¸Šæ¶¨æˆ–ä¸Šä¸‹æ–‡â€œæ¼‚ç§»â€ã€‚  

---

## ğŸ”§ æ•…éšœæ’æŸ¥

- **æ²¡æœ‰ä¸»åŠ¨æ¶ˆæ¯ï¼Ÿ**
  - æ£€æŸ¥ `/aireplay show` æ˜¯å¦æ˜¾ç¤º `subscribed=true`ã€`enable=true`ã€‚
  - ç›®æ ‡å¹³å°æ˜¯å¦æ”¯æŒâ€œä¸»åŠ¨æ¶ˆæ¯â€ï¼Ÿï¼ˆä»¥ AstrBot æ”¯æŒä¸ºå‡†ï¼‰
  - å¤„äºå…æ‰“æ‰°æ—¶æ®µï¼Ÿè§¦å‘æ—¶åˆ»æ˜¯å¦åˆšå¥½è¢«æŒ¡ä½ï¼Ÿ
  - `after_last_msg_minutes=0` ä¸”æœªè®¾ç½® `daily.time1/time2`ï¼Ÿ
  - `timezone` æ˜¯å¦æ­£ç¡®ï¼Ÿ
- **ç»­èŠå†…å®¹ç©ºç™½æˆ–å¾ˆæœºæ¢°ï¼Ÿ**
  - æ·»åŠ /ä¼˜åŒ– `custom_prompt`ã€‚
  - æé«˜æˆ–é™ä½ `history_depth`ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦æºå¸¦åˆ°ä¸Šä¸€è½®ç”¨æˆ·ä¸ AI å†…å®¹ã€‚
  - è€ƒè™‘è®¾å®šæ›´è´´åˆä»»åŠ¡çš„äººæ ¼ï¼ˆ`persona_override`ï¼‰ã€‚
- **æé†’æœªè§¦å‘ï¼Ÿ**
  - ä¸€æ¬¡æ€§æé†’ä½¿ç”¨æœ¬åœ°æ—¶é—´å­—ç¬¦ä¸²å¯¹æ¯”ï¼ˆç²¾ç¡®åˆ°åˆ†é’Ÿï¼‰ï¼›æ£€æŸ¥æ ¼å¼ä¸åˆ†é’Ÿçº§å‘½ä¸­ã€‚  
  - æ¯æ—¥æé†’éœ€åœ¨å‘½ä¸­ `HH:MM` æ—¶åˆ»æ‰è§¦å‘ã€‚

---

## ğŸ“„ ç¤ºä¾‹

**è®¾ç½®â€œæœ€åæ¶ˆæ¯å 45 åˆ†é’Ÿç»­èŠâ€ï¼Œæ¯æ—¥ 09:00/20:00 æé†’å…³å¿ƒ**

```
/aireplay on
/aireplay watch
/aireplay set after 45
/aireplay set daily1 09:00
/aireplay set daily2 20:00
/aireplay set prompt ä½ æ˜¯æ¸©æŸ”ä½“è´´çš„ç”Ÿæ´»åŠ©ç†ï¼Œè¯·åœ¨ä¸æ‰“æ‰°çš„å‰æä¸‹ç»§ç»­è¯é¢˜ï¼Œå¹¶ç»™ä¸€ä¸ªå¯æ‰§è¡Œçš„å°å»ºè®®ã€‚
```

**æ·»åŠ æé†’**

```
/aireplay remind add 2025-10-22 09:30 é¡¹ç›®æ—©ä¼š
/aireplay remind add 21:45 ä¼‘æ¯çœ¼ç› daily
```

---

## ğŸ—‚ï¸ æ•°æ®ä¸æŒä¹…åŒ–

- æ’ä»¶æ•°æ®ç›®å½•ï¼š`AstrBot/data/plugins/astrbot_plugin_aireplay/`
  - `state.json`ï¼šä¼šè¯è®¢é˜…çŠ¶æ€ã€ä¸Šæ¬¡è§¦å‘æ ‡ç­¾ç­‰ã€‚
  - `reminders.json`ï¼šæé†’åˆ—è¡¨ã€‚

> æ–‡ä»¶ä»…å­˜å‚¨å¿…è¦å…ƒæ•°æ®ï¼Œä¸ä¿å­˜æ¨¡å‹è¾“å‡ºã€‚è¯·æ³¨æ„æœåŠ¡å™¨æ–‡ä»¶æƒé™å’Œå¤‡ä»½ç­–ç•¥ã€‚

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿ Issue ä¸ PRï¼
- Repoï¼š<https://github.com/oyxning/astrbot_plugin_AIReplay>
- å»ºè®®æ–¹å‘ï¼šå¤šæ—¶åŒºä¼šè¯ç²’åº¦è¦†ç›–ã€æ›´å¤šé‡å¤è§¦å‘ä¿æŠ¤ç­–ç•¥ã€å¯è§†åŒ–æé†’ç®¡ç†ã€æ›´å¤š Scheduler ç²¾åº¦é€‰é¡¹ã€‚

---

## ğŸ§¾ ç‰ˆæœ¬ä¸å˜æ›´

- **1.0.0**ï¼šé¦–ä¸ªç¨³å®šç‰ˆã€‚æ”¯æŒé—´éš”/æ¯æ—¥ç»­èŠã€å…æ‰“æ‰°ã€æ—¶é—´å­—æ®µã€è‡ªå®šä¹‰æç¤ºè¯ã€æé†’ã€è®¢é˜…æœºåˆ¶ä¸äººæ ¼/å†å²æ‹¼æ¥ã€‚

---

## ğŸ“œ è®¸å¯è¯

MIT
